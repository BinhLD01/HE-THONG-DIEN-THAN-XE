<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HỆ THỐNG ĐIỆN THÂN XE TOYOTA CAMRY</title>

  <!-- Bootstrap (optional for buttons/grid) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <style>
  /* ===== RESET & BASE ===== */
  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; }
  body {
    font-family: "Times New Roman", serif;
    background: #eff9fc;
    color: #262261;
    overflow-x: hidden;
  }
  img { max-width:100%; height:auto; display:block; }

  /* ===== HEADER ===== */
  .site-header { background:#b9cfd7; border-bottom:3px solid #3696b9; }
  .brand-row { align-items:center; padding:10px 12px; }
  .site-header .logo img{ max-width:140px; }

  .divider{ background:#3696b9; height:3px; width:100%; }

  /* ===== MAIN LAYOUT: sidebar INSIDE main (not fixed) ===== */
  main.page { max-width:100%; margin:0 auto; padding:18px; min-height: calc(100vh - 180px); }
  .row.main-row { margin-left:0; margin-right:0; gap:18px; align-items:flex-start; }

  /* columns proportion on large screens */
  @media (min-width: 992px) {
    .col-aside { flex: 0 0 19%; max-width:19%; }
    .col-main  { flex: 0 0 81%; max-width:81%; }
  }

  /* Ép sidebar luôn hiển thị (bất kể kích thước màn hình) */
#sidebarCol,
aside.sidebar {
  display: block !important;
}

/* Nếu muốn menu luôn rộng giống desktop trên mọi kích thước */
.col-aside { flex: 0 0 240px; max-width: 240px; }
.col-main  { margin-left: 0; } /* không cần margin-left do layout trong main */

.system-cards { opacity: 1 !important; transform: none !important; }

  /* Sidebar style (full blue column) */
  aside.sidebar {
    background:#184e9e;
    color:#fff;
    padding:18px;
    border-radius:8px;
  }
  /* ensure visible by default on all sizes (JS will collapse on small screens) */
  .sidebar-expanded { display:block; }
  .sidebar-collapsed { display:none; }

  /* Sidebar menu */
  nav.navbar { padding:0; background:transparent; }
  nav.navbar ul { list-style:none; margin:0; padding:0; }
  nav.navbar ul > li { margin-bottom:8px; }
  nav.navbar ul > li > a{
    display:block; padding:12px 14px; color:#fff; text-decoration:none; font-weight:700;
    border-left:4px solid transparent; transition:background .18s, border-color .18s; font-size:16px;
  }
  nav.navbar ul > li > a:hover,
  nav.navbar ul > li > a.active { background:#2f79aa; border-left-color:#fff; }

  nav.navbar ul li .dropdown { display:none; background:#123a63; margin-top:6px; padding:6px 0; }
  nav.navbar ul li:hover > .dropdown,
  nav.navbar ul li:focus-within > .dropdown { display:block; }
  nav.navbar ul li .dropdown li a { display:block; padding:10px 18px; color:#e6f4ff; font-weight:600; }

  /* ===== CONTENT ===== */
  .content-card { background:#fff; border-radius:20px; padding:28px 22px 36px; box-shadow:0 6px 20px rgba(0,0,0,.06); }
  .content-title { font-family:"Times New Roman", serif; color:#d21313; text-align:center; font-weight:700; font-size:clamp(24px,4vw,40px); margin:0 0 14px; }


  

 .hero-main {
  width: 30%;
  margin: 0 auto 20px;
  border-radius: 0; /* nếu muốn bo góc bỏ dòng này */
  overflow: hidden;
  box-shadow: none;
}

.hero-main img {
  width: 100%;
  height: auto;
  object-fit: cover;
}



  @media (max-width:768px) { .hero-main img { height:280px; } }

  /* System cards: hidden by default, will add .visible to show */
  .system-cards {
    display:grid;
    grid-template-columns:repeat(3,minmax(0,1fr));
    gap:1.8rem;
    margin-top:2rem;
    opacity:0;
    transform:translateY(10px);
    transition: opacity .35s ease, transform .35s ease;
  }
  .system-cards.visible { opacity:1; transform:none; }
  .system-card { background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.06); text-decoration:none; color:inherit; }
  .system-card img { width:100%; height:180px; object-fit:cover; }
  .system-card h4 { text-align:center; padding:12px; margin:0; font-weight:700; color:#0b2c6b; }

  @media (max-width:992px) { .system-cards { grid-template-columns:repeat(2,1fr); } }
  @media (max-width:576px) { .system-cards { grid-template-columns:1fr; } .system-card img{ height:160px; } }

  /* ===== MOBILE: toggle button ===== */
  .menu-toggle { display:none; position:fixed; top:12px; left:12px; z-index:1400; background:#184e9e; color:#fff; border:none; padding:8px 10px; border-radius:8px; font-size:18px; box-shadow:0 3px 10px rgba(0,0,0,.2); }
  @media (max-width:991.98px) { .menu-toggle { display:block; } }

  /* Safety: hide nav/header inside loaded #main-content fragments */
  #main-content nav.navbar,
  #main-content .navbar,
  #main-content aside.sidebar,
  #main-content header,
  #main-content .site-header { display:none !important; }

  /* footer */
  footer.site-footer { background:#b9cfd7; padding:14px 18px; border-top:3px solid #3696b9; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }

  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="container-fluid">
      <div class="row brand-row">
        <div class="col-md-2 logo mt-8  ">
          <img src="img/logo-iuh-1.png" alt="Logo IUH" style="max-width:340px; width:100%; height:auto;">
        </div>
        <div class="col-12 col-md-9 mt-8">
          <h1 class="text-center font-weight-bold">TRƯỜNG ĐẠI HỌC CÔNG NGHIỆP THÀNH PHỐ HỒ CHÍ MINH</h1>
          <h1 class="text-center font-weight-bold">KHOA CÔNG NGHỆ ĐỘNG LỰC</h1>
        </div>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <!-- MAIN -->
  <main class="page">
    <!-- Mobile toggle -->
    <button class="menu-toggle" id="menuToggle" aria-expanded="false" aria-controls="sidebarCol">☰</button>

    <div class="row main-row">
      <!-- SIDEBAR inside main (default expanded on desktop) -->
      <aside class="col-aside sidebar sidebar-expanded" id="sidebarCol" aria-label="Site menu">
        <nav class="navbar" role="navigation" aria-label="Primary menu">
          <ul>
            <li><a href="index.html" data-hard>Trang chủ</a></li>

            <li>
              <a href="#" aria-haspopup="true">Giới thiệu ▾</a>
              <ul class="dropdown">
                <li><a data-ajax href="Gioi_thieu/Tong_quan.html">Tổng quan</a></li>
                <li><a data-ajax href="Gioi_thieu/Chi_tiet_mo_hinh.html">Chi tiết mô hình</a></li>
                <li><a data-ajax href="Gioi_thieu/Hoat_dong_mo_hinh.html">Hoạt động mô hình</a></li>
                <li><a data-ajax href="Gioi_thieu/Ket_qua.html">Kết quả đạt được</a></li>
              </ul>
            </li>

            <li>
              <a href="#" aria-haspopup="true">Nguyên lý hoạt động ▾</a>
              <ul class="dropdown">
                <li><a data-ajax href="Nguyen_ly_hoat_dong/HT_chieu_sang.html">Hệ thống chiếu sáng</a></li>
                <li><a data-ajax href="Nguyen_ly_hoat_dong/HT_tin_hieu.html">Hệ thống tín hiệu</a></li>
                <li><a data-ajax href="Nguyen_ly_hoat_dong/HT_phun_nuoc_gat_mua.html">Phun nước gạt mưa</a></li>
              </ul>
            </li>

            <li>
              <a href="#" aria-haspopup="true">Pan ▾</a>
              <ul class="dropdown">
                <li><a data-ajax href="Pan/HT_chieu_sang/PANCS.html">Chiếu sáng</a></li>
                <li><a data-ajax href="Pan/HT_tin_hieu/PANTH.html">Tín hiệu</a></li>
                <li><a data-ajax href="Pan/HT_phun_nuoc_gat_mua/PANGM.html">Phun nước gạt mưa</a></li>
              </ul>
            </li>

            <li><a data-ajax href="Lien_he.html">Liên hệ</a></li>
            <li><a data-ajax href="TAI_LIEU.html">Tài liệu tham khảo</a></li>
            <li><a data-ajax href="Cac_cuc_ECU/Cu1.html">Phụ lục</a></li>
          </ul>
        </nav>
      </aside>

      <!-- CONTENT -->
      <section class="col-main">
        <section id="main-content" class="content-card" tabindex="-1">
          <h1 class="content-title">MÔ HÌNH HỆ THỐNG ĐIỆN THÂN XE TOYOTA CAMRY 2006</h1>

          <div class="hero-main" id="heroMain">
            <img src="img/Mat_sau_mo_hinh.png" alt="Mô hình hệ thống điện thân xe Toyota Camry 2006">
          </div>

          <!-- <div class="text-center" style="margin-bottom:12px;">
            <button id="toggle-systems" class="btn btn-primary btn-lg mt-2" aria-controls="systemList">Xem các hệ thống</button>
          </div> -->

          <div class="system-cards" id="systemList" aria-live="polite">
            <a data-ajax href="Nguyen_ly_hoat_dong/HT_chieu_sang.html" class="system-card">
              <img src="img/HT-chieu-sang.png" alt="Chiếu sáng">
              <h4>HỆ THỐNG CHIẾU SÁNG</h4>
            </a>

            <a data-ajax href="Nguyen_ly_hoat_dong/HT_tin_hieu.html" class="system-card">
              <img src="img/HT_Tin_hieu.png" alt="Tín hiệu">
              <h4>HỆ THỐNG TÍN HIỆU</h4>
            </a>

            <a data-ajax href="Nguyen_ly_hoat_dong/HT_phun_nuoc_gat_mua.html" class="system-card">
              <img src="img/HT_PhunNuoc_GatMua.png" alt="Phun nước">
              <h4>HỆ THỐNG PHUN NƯỚC GẠT MƯA</h4>
            </a>

            <a data-ajax href="Pan/HT_chieu_sang/PANCS.html" class="system-card">
              <img src="img/Pan_HT_Chieu_sang.png" alt="Pan chiếu sáng">
              <h4>PAN HỆ THỐNG CHIẾU SÁNG</h4>
            </a>

            <a data-ajax href="Pan/HT_tin_hieu/PANTH.html" class="system-card">
              <img src="img/Pan-HT-tín-hiệu.png" alt="Pan tín hiệu">
              <h4>PAN HỆ THỐNG TÍN HIỆU</h4>
            </a>

            <a data-ajax href="Pan/HT_phun_nuoc_gat_mua/PANGM.html" class="system-card">
              <img src="img/Pan_PhunNuoc_Gat_Mua.png" alt="Pan phun nước gạt mưa">
              <h4>PAN HỆ THỐNG PHUN NƯỚC GẠT MƯA</h4>
            </a>
          </div>
        </section>
      </section>
    </div>
  </main>

  <div class="divider"></div>

  <footer class="site-footer">
    <p class="footer-left">GVHD: Th.S Đỗ Sĩ Hải</p>
    <div class="links-container"><a href="Instructors.html" class="arrow">→ Sinh Viên Thực Hiện</a></div>
  </footer>

  <!-- SCRIPTS -->
  <script>
  // Remove duplicate UI from loaded fragments
  function cleanLoadedNode(node) {
    node.querySelectorAll('nav.navbar, .navbar, aside.sidebar, header, .site-header').forEach(el => el.remove());
    return node;
  }

  function extractContent(html) {
    const temp = document.createElement('div');
    temp.innerHTML = html;
    const pickers = ['main#page-content','section[data-content="main"]','main .content-card','main','section.content-card','section'];
    let node = null;
    for (const sel of pickers) {
      const found = temp.querySelector(sel);
      if (found) { node = found; break; }
    }
    if (!node) node = temp;
    cleanLoadedNode(node);
    return node.innerHTML;
  }

  document.addEventListener('DOMContentLoaded', function () {
    // AJAX navigation
    document.addEventListener('click', function (e) {
      const link = e.target.closest('a[data-ajax], a[data-hard]');
      if (!link) return;
      const url = link.getAttribute('href') || '';
      const isSpecial = !url || url === '#' || /\.pdf$/i.test(url);
      if (isSpecial) return;
      const isHome = link.hasAttribute('data-hard') ||
                     /(^|\/)index\.html(?:[#?].*)?$/i.test(url) ||
                     url === '/' || url === window.location.pathname;
      if (isHome) return;
      e.preventDefault();
      loadInto('#main-content', url);
    });

    function loadInto(targetSelector, url) {
      const target = document.querySelector(targetSelector);
      if (!target) return;
      target.classList.add('loading');
      target.innerHTML = '<p class="text-center" style="color:#184e9e;">Đang tải nội dung...</p>';
      fetch(url).then(res => {
        if (!res.ok) throw new Error('Không thể tải nội dung: ' + url);
        return res.text();
      }).then(html => {
        target.innerHTML = extractContent(html);
        target.classList.remove('loading');
        // re-run reveal
        observeHeroAndReveal();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }).catch(err => {
        target.classList.remove('loading');
        target.innerHTML = `<p style="color:red;text-align:center;">${err.message}</p>`;
      });
    }

    // toggle button (keeps it available)
    const toggleBtn = document.getElementById('toggle-systems');
    const systemCards = document.getElementById('systemList');
    if (toggleBtn && systemCards) {
      toggleBtn.addEventListener('click', function () {
        const showing = systemCards.classList.toggle('visible');
        toggleBtn.textContent = showing ? 'Ẩn các hệ thống' : 'Xem các hệ thống';
        if (showing) systemCards.scrollIntoView({ behavior:'smooth', block:'start' });
        else window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // mobile sidebar collapse/expand
    const menuToggle = document.getElementById('menuToggle');
    const sidebarCol = document.getElementById('sidebarCol');
    function setSidebarInitial() {
      if (!sidebarCol) return;
      if (window.innerWidth <= 991.98) {
        sidebarCol.classList.remove('sidebar-expanded');
        sidebarCol.classList.add('sidebar-collapsed');
        menuToggle.setAttribute('aria-expanded','false');
      } else {
        sidebarCol.classList.remove('sidebar-collapsed');
        sidebarCol.classList.add('sidebar-expanded');
        menuToggle.setAttribute('aria-expanded','true');
      }
    }
    setSidebarInitial();
    window.addEventListener('resize', setSidebarInitial);

    if (menuToggle && sidebarCol) {
      menuToggle.addEventListener('click', () => {
        const collapsed = sidebarCol.classList.contains('sidebar-collapsed');
        if (collapsed) {
          sidebarCol.classList.remove('sidebar-collapsed');
          sidebarCol.classList.add('sidebar-expanded');
          menuToggle.setAttribute('aria-expanded','true');
        } else {
          sidebarCol.classList.remove('sidebar-expanded');
          sidebarCol.classList.add('sidebar-collapsed');
          menuToggle.setAttribute('aria-expanded','false');
        }
      });
    }

    // reveal system-cards when hero leaves viewport (or when hero missing show immediately)
    function observeHeroAndReveal(){
      const hero = document.getElementById('heroMain');
      const list = document.getElementById('systemList');
      if (!list) return;
      if (list.classList.contains('visible')) return;
      if (!hero) { list.classList.add('visible'); return; }
      const obs = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting) {
            list.classList.add('visible');
            obs.disconnect();
          }
        });
      }, { root:null, threshold: 0 });
      obs.observe(hero);
    }
    observeHeroAndReveal();
  });

  // PAN loader helpers (kept)
  function pickFragment(root) {
    return root.querySelector('[data-fragment]') || root.querySelector('main#page-content') || root.querySelector('main') || root.querySelector('section') || root;
  }
  function absolutizeAttr(root, selector, attr, baseAbs) {
    const SITE_ROOT = new URL('./', location.href);
    root.querySelectorAll(selector).forEach(el => {
      let val = el.getAttribute(attr);
      if (!val) return;
      if (/^(https?:|mailto:|tel:|#|data:)/i.test(val)) return;
      const normalized = val.replace(/^(\.\/)+/i, '').replace(/^(\.\.\/)+/i, '');
      if (/^img\//i.test(normalized)) {
        el.setAttribute(attr, new URL(normalized, SITE_ROOT).href);
      } else {
        el.setAttribute(attr, new URL(val, baseAbs).href);
      }
    });
  }
  async function loadPanContent(url) {
    const area = document.getElementById('content-area');
    if (!area) return;
    const absUrl = new URL(url, location.href).href;
    area.innerHTML = '<p class="text-center" style="color:#184e9e;">Đang tải nội dung...</p>';
    try {
      const res = await fetch(absUrl);
      if (!res.ok) throw new Error('Không thể tải nội dung: ' + absUrl);
      const html = await res.text();
      const doc = new DOMParser().parseFromString(html, 'text/html');
      const frag = pickFragment(doc);
      absolutizeAttr(frag, 'img', 'src', absUrl);
      absolutizeAttr(frag, 'link', 'href', absUrl);
      absolutizeAttr(frag, 'script', 'src', absUrl);
      absolutizeAttr(frag, 'a', 'href', absUrl);
      frag.querySelectorAll('nav.navbar, .navbar, aside.sidebar, header, .site-header').forEach(el => el.remove());
      area.innerHTML = frag.innerHTML;
      area.querySelectorAll('a[href]').forEach(a => {
        const href = a.getAttribute('href');
        if (!href || href.startsWith('#') || /\.pdf$/i.test(href) || a.target === '_blank') return;
        let u; try { u = new URL(href, absUrl); } catch { return; }
        if (u.origin === location.origin) {
          a.addEventListener('click', ev => {
            ev.preventDefault();
            loadPanContent(u.href);
          });
        }
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } catch (err) {
      area.innerHTML = `<p style="color:red;text-align:center;">${err.message}</p>`;
    }
  }
  </script>
</body>
</html>
